<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>補助金診断レポート生成システム</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; }
        .container { max-width: 900px; margin-top: 30px; }
        #report-preview { background: white; padding: 40px; border: 1px solid #ddd; display: none; margin-top: 20px; }
        .result-value { font-size: 1.5rem; color: #d9534f; font-weight: bold; }
        .advice-box { background-color: #e9ecef; padding: 15px; border-left: 5px solid #0d6efd; margin: 15px 0; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

<div class="container no-print">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">顧客情報入力フォーム</h5>
        </div>
        <div class="card-body">
            <form id="subsidy-form">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">従業員数</label>
                        <input type="number" id="emp_count" class="form-control" value="10" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">所在地</label>
                        <input type="text" id="location" class="form-control" value="東京都品川区" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">資本金（万円）</label>
                        <input type="number" id="capital" class="form-control" value="100" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">業種</label>
                        <select id="industry" class="form-select">
                            <option value="情報通信業">情報通信業</option>
                            <option value="製造業">製造業</option>
                            <option value="小売・卸売業">小売・卸売業</option>
                            <option value="サービス業">サービス業</option>
                        </select>
                    </div>
                </div>
                <button type="button" onclick="generateReport()" class="btn btn-success mt-4 w-100">レポートを生成する</button>
            </form>
        </div>
    </div>
</div>

<div id="report-preview" class="container">
    <div class="text-center">
        <h2 class="mb-4">補助金・助成金活用診断レポート</h2>
        <p class="text-end">作成日: 2026年1月28日</p>
    </div>
    <hr>
    
    <h4>1. 顧客情報（診断対象）</h4>
    <table class="table table-bordered">
        <tr><th width="30%">従業員数</th><td id="view_emp"></td></tr>
        <tr><th>所在地</th><td id="view_loc"></td></tr>
        <tr><th>資本金</th><td id="view_cap"></td></tr>
        <tr><th>業種</th><td id="view_ind"></td></tr>
    </table>

    <h4 class="mt-4">2. 受け取れる年間想定額</h4>
    <div class="text-center p-3 border border-danger">
        <span class="result-value" id="view_amount"></span>
    </div>

    <h4 class="mt-4">3. 専門家の見解・アドバイス</h4>
    <div class="advice-box" id="view_advice"></div>

    <h4 class="mt-4">4. 活用可能性が高い補助金リスト</h4>
    <table class="table table-striped mt-2">
        <thead class="table-dark">
            <tr>
                <th>制度名称</th>
                <th>概要</th>
                <th>補助上限額</th>
            </tr>
        </thead>
        <tbody id="list_body">
            </tbody>
    </table>

    <div class="text-center mt-5 no-print">
        <button onclick="downloadPDF()" class="btn btn-danger btn-lg">PDFとして保存・出力</button>
    </div>
</div>

<script>
    function generateReport() {
        const emp = document.getElementById('emp_count').value;
        const loc = document.getElementById('location').value;
        const cap = document.getElementById('capital').value;
        const ind = document.getElementById('industry').value;

        // 表示に反映
        document.getElementById('view_emp').innerText = emp + " 名";
        document.getElementById('view_loc').innerText = loc;
        document.getElementById('view_cap').innerText = cap + " 万円";
        document.getElementById('view_ind').innerText = ind;

        // 金額とアドバイスのロジック
        let amount = "500万円 〜 1,000万円";
        let advice = "";
        let listHtml = "";

        if(ind === "情報通信業") {
            advice = `<strong>IT投資の絶好のタイミングです。</strong><br>
                      ${loc}でのIT事業は、最新設備の導入やソフトウェア開発において、国と地方自治体の両方から支援を受けられる可能性が非常に高いです。
                      特に資本金${cap}万円という規模感は、中小企業支援の枠組みを最大限に活用できます。`;
            listHtml = `
                <tr><td>IT導入補助金</td><td>ソフトウェア・クラウド導入</td><td>最大450万円</td></tr>
                <tr><td>ものづくり補助金</td><td>革新的なシステム開発</td><td>最大1,250万円</td></tr>
                <tr><td>キャリアアップ助成金</td><td>正社員化による人材定着</td><td>80万円/人</td></tr>
            `;
        }

        document.getElementById('view_amount').innerText = amount;
        document.getElementById('view_advice').innerHTML = advice;
        document.getElementById('list_body').innerHTML = listHtml;

        document.getElementById('report-preview').style.display = 'block';
        window.scrollTo(0, document.getElementById('report-preview').offsetTop);
    }

    async function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const element = document.getElementById('report-preview');
        const canvas = await html2canvas(element, { scale: 2 });
        const imgData = canvas.toDataURL('image/png');
        
        const pdf = new jsPDF('p', 'mm', 'a4');
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
        
        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        pdf.save("補助金診断レポート.pdf");
    }
</script>

</body>
</html>
